<div class="user-order-history">
  <nav class="navbar">
    <div class="logo">
      <a href="home.component.html" style="text-decoration:none;color: #fff;">
        Grocery<span>Mart</span>
      </a>
    </div>
    
    <div class="search-container">
      <input 
        type="text" 
        placeholder="Search orders..." 
        [(ngModel)]="searchQuery"
        (keypress)="onKeyPress($event)"
      />
      <button type="submit" (click)="onSearch()">
        <i class="fa fa-search" style="color: white;"></i>
      </button>
      <button 
        *ngIf="searchQuery" 
        type="button" 
        (click)="onClearSearch()" 
        style="background: none; border: none; color: white; cursor: pointer; margin-left: 5px;"
        title="Clear search"
      >
        Ã—
      </button>
    </div>

    <div class="links">
      <a routerLink="/add-to-cart">Cart</a>
      <a routerLink="/user-dashboard/profile">Profile</a>
      <a routerLink="/user-dashboard">Dashboard</a>
      <a (click)="logout()" style="cursor: pointer;">Logout</a>
    </div>
  </nav>

  <div class="main-content">
    <div class="header">
      <h1>My Order History</h1>
      <button (click)="loadOrders()" class="refresh-btn" [disabled]="loading">
        <i class="fa fa-refresh"></i> Refresh
      </button>
    </div>

    <div class="content">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading">
        <p>Loading orders...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error" class="error">
        <p>{{ error }}</p>
        <button (click)="loadOrders()" class="retry-btn">Retry</button>
      </div>

      <!-- No Orders State -->
      <div *ngIf="!loading && !error && filteredOrders.length === 0 && !searchQuery" class="no-orders">
        <p>No orders found.</p>
      </div>

      <!-- No Search Results State -->
      <div *ngIf="!loading && !error && filteredOrders.length === 0 && searchQuery" class="no-orders">
        <p>No orders found matching your search.</p>
      </div>

      <!-- Orders Table -->
      <div *ngIf="!loading && !error && filteredOrders.length > 0" class="orders-table-container">
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Order Date</th>
              <th>Total Amount</th>
              <th>Items</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of filteredOrders">
              <td>{{ order.id }}</td>
              <td>{{ formatDate(order.orderTime) }}</td>
              <td>{{ formatPrice(order.totalAmount) }}</td>
              <td>
                <div class="order-items">
                  <div *ngFor="let item of order.items" class="order-item">
                    <span class="item-name">{{ item.productName }}</span>
                    <span class="item-details">
                      {{ item.quantity }} Ã— {{ formatPrice(item.price) }}
                    </span>
                  </div>
                </div>
              </td>
              <td>
                <button 
                  class="invoice-btn" 
                  (click)="viewInvoice(order.id)"
                  title="View Invoice"
                >
                  ðŸ“„ Invoice
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation Dialog -->
  <app-confirmation-dialog
    [isVisible]="showLogoutConfirm"
    title="Confirm Logout"
    message="Are you sure you want to logout? You will be redirected to the home page."
    confirmText="Yes, Logout"
    cancelText="Cancel"
    (confirm)="confirmLogout()"
    (cancel)="cancelLogout()">
  </app-confirmation-dialog>
</div> 