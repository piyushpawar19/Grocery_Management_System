<nav class="navbar">
  <button class="btn back" (click)="goBack()">‚Üê</button>
  <div class="logo">
    <a
      href="home.component.html"
      style="text-decoration: none; color: #fff; margin-right: -60px"
    >
      Grocery<span>Mart</span></a
    >
  </div>
  <!-- <input type="text" placeholder="Search groceries..." /> -->

  <!-- <div class="search-container">
      <input type="text" placeholder="Search groceries..." />
      <button type="submit">
        <i class="fa fa-search" style="color: white;"></i>
      </button>
    </div> -->

  <!-- <div class="links">
    <a routerLink="/register">Register</a>
    <a routerLink="/login-selection">Login</a>
  </div> -->
  <div class="links">
    <!-- <a routerLink="/add-to-cart">Cart</a> -->
    <a routerLink="/user-dashboard/profile">Profile</a>
    <a (click)="showLogoutConfirm = true" style="cursor: pointer">Logout</a>
  </div>
</nav>

<div class="order-form">
  <h2>Order Details</h2>
  <p>Total Items: {{ totalItems }}</p>
  <p>Total Price: ${{ totalAmount.toFixed(2) }}</p>

  <!-- Error message -->
  <div
    *ngIf="errorMsg"
    class="error-message"
    style="color: red; margin-bottom: 10px"
  >
    {{ errorMsg }}
  </div>

  <form [formGroup]="form" (ngSubmit)="placeOrder()">
    <label>Card Holder Name</label>
    <input formControlName="cardName" />
    <div class="error-message" *ngIf="isFieldInvalid('cardName')">
      {{ getErrorMessage("cardName") }}
    </div>

    <label>Card Number</label>
    <input
      formControlName="cardNumber"
      maxlength="16"
      (keypress)="onCardNumberKeyPress($event)"
      placeholder="1234567890123456"
    />
    <div class="error-message" *ngIf="isFieldInvalid('cardNumber')">
      {{ getErrorMessage("cardNumber") }}
    </div>

    <label>CVV</label>
    <input
      formControlName="cvv"
      maxlength="3"
      type="password"
      (keypress)="onCvvKeyPress($event)"
      placeholder="123"
    />
    <div class="error-message" *ngIf="isFieldInvalid('cvv')">
      {{ getErrorMessage("cvv") }}
    </div>

    <div class="expiry-container">
      <div class="expiry-field">
        <label>Expiry Month</label>
        <select formControlName="expiryMonth">
          <option value="">Month</option>
          <option
            *ngFor="let month of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]"
            [value]="month"
          >
            {{ month.toString().padStart(1, "") }}
          </option>
        </select>
        <div class="error-message" *ngIf="isFieldInvalid('expiryMonth')">
          {{ getErrorMessage("expiryMonth") }}
        </div>
      </div>

      <div class="expiry-field">
        <label>Expiry Year</label>
        <select formControlName="expiryYear">
          <option value="">Year</option>
          <option *ngFor="let year of years" [value]="year">
            {{ year }}
          </option>
        </select>
        <div class="error-message" *ngIf="isFieldInvalid('expiryYear')">
          {{ getErrorMessage("expiryYear") }}
        </div>
      </div>
    </div>

    <button type="submit" [disabled]="form.invalid || loading">
      <span *ngIf="!loading">Place Order</span>
      <span *ngIf="loading">Processing...</span>
    </button>
  </form>
</div>

<!-- Success Modal dialog -->
<div class="modal-backdrop" *ngIf="showDialog">
  <div class="modal">
    <p>{{ dialogMessage }}</p>
    <button (click)="confirmDialog()">OK</button>
  </div>
</div>

<!-- Payment Error Modal dialog -->
<div class="modal-backdrop" *ngIf="showErrorDialog">
  <div class="modal error-modal">
    <p>{{ dialogMessage }}</p>
    <button (click)="closeErrorDialog()">OK</button>
  </div>
</div>

<!-- Validation Error Modal dialog -->
<div class="modal-backdrop" *ngIf="showValidationErrorDialog">
  <div class="modal error-modal">
    <p>Please correct the highlighted fields before placing your order.</p>
    <button (click)="closeValidationErrorDialog()">OK</button>
  </div>
</div>

<!-- Logout Confirmation Dialog -->
<div class="dialog-overlay" *ngIf="showLogoutConfirm">
  <div class="dialog-box">
    <p>Are you sure you want to logout?</p>
    <div class="dialog-buttons">
      <button (click)="confirmLogout()" class="yes">Yes</button>
      <button (click)="cancelLogout()" class="no">No</button>
    </div>
  </div>
</div>
