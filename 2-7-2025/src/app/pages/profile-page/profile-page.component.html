<nav class="navbar">
  <button class="btn back" (click)="goBack()">‚Üê</button>
  <div class="logo">
    <a
      href="home.component.html"
      style="text-decoration: none; color: #fff; margin-right: -60px"
    >
      Grocery<span>Mart</span></a
    >
  </div>
  <div class="search-container">
    <input type="text" placeholder="Search groceries..." />
    <button type="submit">
      <i class="fa fa-search" style="color: white"></i>
    </button>
  </div>
  <div class="links">
    <a routerLink="/user-dashboard/profile">Profile</a>
    <a (click)="showLogoutConfirm = true" style="cursor: pointer">Logout</a>
  </div>
</nav>

<div class="profile-container">
  <aside class="sidebar">
    <button class="sidebar-btn active">Basic Details</button>
    <button
      class="sidebar-btn"
      routerLink="/user-dashboard/profile/change-password"
    >
      Change Password
    </button>
  </aside>

  <section class="content">
    <h2>Basic Details</h2>
    <form [formGroup]="profileForm" (ngSubmit)="save()">
      <div *ngIf="errorMsg" class="error" style="margin-bottom: 10px">
        {{ errorMsg }}
      </div>
      <div *ngIf="loading" class="spinner">Loading...</div>
      <label>Customer ID</label>
      <input formControlName="id" type="text" [disabled]="true" />

      <label>Enter your name</label>
      <input
        formControlName="customerName"
        type="text"
        placeholder="John Doe"
        [class.invalid]="showError('customerName')"
        [disabled]="!isEditMode || loading"
        (blur)="onBlur('customerName')"
      />
      <div class="error" *ngIf="showError('customerName')">
        {{ getErrorMsg("customerName") }}
      </div>

      <label>Enter your address</label>
      <input
        formControlName="address"
        type="text"
        placeholder="123 Main St, City"
        [class.invalid]="showError('address')"
        [disabled]="!isEditMode || loading"
        (blur)="onBlur('address')"
      />
      <div class="error" *ngIf="showError('address')">
        {{ getErrorMsg("address") }}
      </div>

      <label>Enter your mobile number</label>
      <input
        formControlName="contactNumber"
        type="tel"
        maxlength="10"
        placeholder="9876543210"
        [class.invalid]="showError('contactNumber')"
        [disabled]="!isEditMode || loading"
        (blur)="onBlur('contactNumber')"
      />
      <div class="error" *ngIf="showError('contactNumber')">
        {{ getErrorMsg("contactNumber") }}
      </div>

      <label>Enter your email</label>
      <input
        formControlName="email"
        type="email"
        placeholder="john.doe@example.com"
        [class.invalid]="showError('email')"
        [disabled]="!isEditMode || loading"
        (blur)="onBlur('email')"
      />
      <div class="error" *ngIf="showError('email')">
        {{ getErrorMsg("email") }}
      </div>

      <div class="error" *ngIf="updateErrorMsg">{{ updateErrorMsg }}</div>

      <div class="buttons">
        <button
          type="button"
          class="btn edit"
          (click)="toggleEdit()"
          *ngIf="!isEditMode && !loading && !errorMsg"
        >
          Update
        </button>
        <button
          type="submit"
          class="btn save"
          *ngIf="isEditMode"
          [disabled]="profileForm.invalid || loading || !!errorMsg"
        >
          Save
        </button>
        <button
          type="button"
          class="btn edit"
          (click)="cancelEdit()"
          *ngIf="isEditMode"
          [disabled]="loading"
        >
          Cancel
        </button>
      </div>
    </form>
  </section>
</div>

<!-- Update Success Dialog -->
<div class="modal-backdrop" *ngIf="showUpdateDialog">
  <div class="modal">
    <p>
      Profile updated successfully! Your new email:
      <b>{{ profileForm.get("email")?.value }}</b>
    </p>
    <button (click)="closeDialog()">OK</button>
  </div>
</div>

<!-- Logout Confirmation Dialog -->
<div class="dialog-overlay" *ngIf="showLogoutConfirm">
  <div class="dialog-box">
    <p>Are you sure you want to logout?</p>
    <div class="dialog-buttons">
      <button (click)="confirmLogout()" class="yes">Yes</button>
      <button (click)="cancelLogout()" class="no">No</button>
    </div>
  </div>
</div>
